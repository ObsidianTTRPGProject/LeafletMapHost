<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Leaflet Custom Battlemap</title>

  <!-- 1) Leaflet CSS (no integrity attribute to avoid any SRI issues) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    /* 2) Give #map a fixed height so it’s visible */
    #map {
      width: 100%;
      height: 600px; /* you can adjust this as needed */
      background: #000; /* optional: helps diagnose if image fails to load */
    }
  </style>
</head>

<body>
  <!-- 3) (Optional) A heading so you know the page loaded -->
  <h2 style="text-align:center; margin: 10px 0;">Custom Battlemap (66-Road-Encounter-L)</h2>

  <!-- 4) The Leaflet map container -->
  <div id="map"></div>

  <!-- 5) Leaflet JS (no integrity attribute) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <script>
    // ▮ A) Tell Leaflet to use a “simple” CRS (no lat/lng projection)
    var map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,        // allow user to zoom out if they want
      maxZoom: 2          // adjust as needed (bigger => more zoom‐in)
    });

    // ▮ B) Define the dimensions of your JPEG/PNG in **pixels**
    //    In our case, the image is 1100 px (width) × 1130 px (height).
    //    You can double-check by right-clicking the JPEG → Properties, or:
    //      var img = new Image(); img.src = '66-Road-Encounter-L.jpg'; console.log(img.width, img.height);
    var imgWidth  = 1100;
    var imgHeight = 1130;

    // ▮ C) Create “bounds” in the Simple CRS: [top-left, bottom-right]
    //    Leaflet expects bounds in the form [[y₁, x₁], [y₂, x₂]].
    //    Here, (0,0) is top-left; (imgHeight, imgWidth) is bottom-right.
    var southWest = map.unproject([0, imgHeight], map.getMaxZoom());    // top-left corner
    var northEast = map.unproject([imgWidth, 0], map.getMaxZoom());     // bottom-right corner
    // Actually, unproject([px, py]) returns latlng; but for CRS.Simple, you can also do L.latLng(y, x) directly.
    // For clarity, we’ll define bounds as “pixel coordinates interpreted as CRS.Simple”:
    var imageBounds = [[imgHeight, 0], [0, imgWidth]]; 
    // ↑ Or use: var imageBounds = [[0, 0], [imgHeight, imgWidth]] depending on how you want “orientation.”
    // Leaflet’s docs often show: var imageBounds = [[0,0], [height, width]] when using CRS.Simple.

    // ▮ D) Add the image overlay to the map with those bounds.
    var battlemap = L.imageOverlay(
      '66-Road-Encounter-L.jpg',  // relative URL to your file (in same folder)
      imageBounds, 
      { opacity: 1.0 }
    ).addTo(map);

    // ▮ E) Set the view so that the image is centered and at a good zoom.
    //    We choose the center of the image (imgWidth/2, imgHeight/2) in CRS.Simple coords.
    var centerPoint = L.latLng(imgHeight / 2, imgWidth / 2);
    map.setView(centerPoint, 0);  // “zoom 0” lets you see the entire image initially

    // ▮ F) Optional: Constrain the user so they can’t pan off into empty space
    //    By setting maxBounds to the same “pixel bounds” you used above:
    map.setMaxBounds(imageBounds);
    map.on('drag', function() {
      map.panInsideBounds(imageBounds, { animate: false });
    });

    // ▮ G) (Optional) If you want a 5 ft‐grid overlay, you can add a simple grid of polylines:
    //    Suppose each square is 50 px on your image. You can draw horizontal/vertical lines at intervals of 50 px.
    //    Example: draw vertical lines every 50 px from x=0→x=imgWidth, and horizontal from y=0→y=imgHeight.
    //    Uncomment the code below and adjust `gridPixelSize = 50;` as needed.

    /*
    var gridPixelSize = 50; // e.g., 50 px = 5 ft square
    var gridLines = [];

    // Vertical lines
    for (var x = 0; x <= imgWidth; x += gridPixelSize) {
      var line = L.polyline([
        [0, x],          // top at y=0, x
        [imgHeight, x]   // bottom at y=imgHeight, x
      ], {color: '#666', weight: 1, opacity: 0.5}).addTo(map);
      gridLines.push(line);
    }

    // Horizontal lines
    for (var y = 0; y <= imgHeight; y += gridPixelSize) {
      var line = L.polyline([
        [y, 0],          // left at x=0, y
        [y, imgWidth]    // right at x=imgWidth, y
      ], {color: '#666', weight: 1, opacity: 0.5}).addTo(map);
      gridLines.push(line);
    }
    */

    // ▮ H) (Optional) Add a marker at a given pixel‐coord
    //    E.g. place an encounter token at “pixel (600, 700)”. We do:
    var marker = L.circleMarker(
      L.latLng(700, 600), // [y, x] in pixel coordinates
      { radius: 10, color: 'red', fillOpacity: 0.8 }
    ).addTo(map);
    marker.bindPopup("Encounter here");

  </script>
</body>
</html>
